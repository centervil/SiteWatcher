# 2025-03-18 zenn-article-format-fix

## 今日の開発テーマ

今日の開発テーマは、CI/CDパイプラインで生成されるZenn公開用記事のフォーマット問題の修正です。記事ファイルが誤ってコードブロックとして囲まれてしまう問題の原因特定と解決を目指します。

## 前日までの活動履歴
前日までの活動履歴は以下の通りです：
* 2025-03-17: CI/CDパイプラインの修正
* 2025-03-16: Zennテンプレート適用の問題解決
* 2025-03-15: Zennリポジトリへのプッシュ機能統合
* 2025-03-13: diary-converterのCI/CD組み込み

## 会話ログ

- ユーザー: 昨日、CI/CDパイプラインによって公開用日記をZenn公開用リポジトリにプッシュした際に、zenn側でエラーが出ていました。原因は、プッシュされた記事のフォーマットが合っていなかったためです。具体的には、ファイルの先頭と末行が、```markdown のようにコードを表示するときに使う記号で囲まれていました。なぜこうなってしまったのか、原因を考えて修正してください。これが、今日の開発テーマです。

- LLM: 開発日記を作成し、テーマを記録しました。問題の原因を調査するため、関連するファイルを確認していきます。

- LLM: diary_converter.pyの実装を確認したところ、問題の原因が特定できました。generate_prompt関数で、テンプレートの内容をコードブロックとして扱っているため、生成された記事全体がコードブロックとして出力されてしまっています。具体的には、プロンプトの中でfrontmatterとメッセージボックスの部分をコードブロック（```）で囲んでいることが問題でした。

- LLM: diary_converter.pyのgenerate_prompt関数を修正しました。主な修正点は以下の通りです：
1. frontmatterとメッセージボックスのテンプレートを別の変数として定義し、コードブロックで囲まないようにしました
2. プロンプト内でテンプレートを直接表示するように変更し、コードブロックを使用しないようにしました
3. 出力形式の説明に「コードブロックは必要な場合のみ使用し、記事全体をコードブロックで囲まないでください」という明示的な指示を追加しました

## 課題と解決策

### 課題1: 生成された記事がコードブロックで囲まれる問題
- **問題点**: CI/CDパイプラインで生成された記事ファイルが、コードブロック（```markdown）で囲まれてしまう
- **原因**: diary_converter.pyのgenerate_prompt関数で、テンプレートの内容をコードブロックとして扱っていた
- **解決策**: 
  1. frontmatterとメッセージボックスのテンプレートを別の変数として定義
  2. プロンプト内でテンプレートを直接表示するように変更
  3. コードブロックを使用しない明示的な指示を追加

## 次のステップ

1. CI/CDパイプラインで修正したdiary_converter.pyをテスト実行
2. 生成された記事のフォーマットを確認
3. 必要に応じて追加の修正を実施 